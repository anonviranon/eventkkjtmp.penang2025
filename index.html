<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minggu Sempena Mesyuarat Agung Kesatuan JTMP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .form-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .form-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 p-4 sm:p-6 lg:p-8">

    <!-- Background Audio Player -->
    <audio src="assets/background-music.mp3" autoplay loop class="hidden"></audio>

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="mb-8 text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 dark:text-white">Pendaftaran</h1>
            <p class="text-gray-500 dark:text-gray-400 mt-2">Minggu Perhimpunan Agung KKJTMP</p>
        </header>

        <!-- Forms Grid -->
        <div id="forms-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">

            <!-- Card 1: BGM (Annual Meeting) -->
            <a id="form-card-1" href="https://docs.google.com/forms/d/e/1FAIpQLSe_.../viewform" target="_blank" class="form-card block bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden p-6">
                <div class="flex flex-col items-start h-full">
                    <div class="bg-indigo-100 dark:bg-indigo-900 p-4 rounded-lg mb-4">
                        <svg class="w-10 h-10 text-indigo-500 dark:text-indigo-400" xmlns="https://cdn-icons-png.flaticon.com/128/7185/7185645.png" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm6-11a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">Mesyuarat Agong</h2>
                    <p class="response-count text-3xl font-bold text-indigo-600 dark:text-indigo-400">...</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1 mb-4">Jumlah Pendaftaran</p>
                    <div class="mt-auto pt-4 border-t border-gray-200 dark:border-gray-700 w-full text-sm text-gray-600 dark:text-gray-300">
                        <p class="last-response">Mengutip data...</p>
                    </div>
                </div>
            </a>

            <!-- Card 2: Kursus -->
            <a id="form-card-2" href="https://docs.google.com/forms/d/e/1FAIpQLSf_.../viewform" target="_blank" class="form-card block bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden p-6">
                <div class="flex flex-col items-start h-full">
                    <div class="bg-green-100 dark:bg-green-900 p-4 rounded-lg mb-4">
                        <svg class="w-10 h-10 text-green-500 dark:text-green-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 006 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0118 16.5h-2.25m-7.5 0h7.5m-7.5 0l-1 1.085-1.085-1.085m1.085 1.085L5.25 16.5m7.5 0H3.75m14.25-13.5v11.25c0 .621-.504 1.125-1.125 1.125h-2.25" />
                        </svg>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">Kursus</h2>
                    <p class="response-count text-3xl font-bold text-green-600 dark:text-green-400">...</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1 mb-4">Jumlah Pendaftaran</p>
                    <div class="mt-auto pt-4 border-t border-gray-200 dark:border-gray-700 w-full text-sm text-gray-600 dark:text-gray-300">
                        <p class="last-response">Mengutip data...</p>
                    </div>
                </div>
            </a>

            <!-- Card 3: Night Gala -->
            <a id="form-card-3" href="https://anonviranon.github.io/thekenduri/" target="_blank" class="form-card block bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden p-6">
                <div class="flex flex-col items-start h-full">
                    <div class="bg-blue-100 dark:bg-blue-900 p-4 rounded-lg mb-4">
                        <svg class="w-10 h-10 text-blue-500 dark:text-blue-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.3-2.3L12.75 18l1.178-.398a3.375 3.375 0 002.3-2.3L16.5 14.25l.398 1.178a3.375 3.375 0 002.3 2.3l1.178.398-1.178.398a3.375 3.375 0 00-2.3 2.3z" />
                        </svg>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">Malam Gala</h2>
                    <p class="response-count text-3xl font-bold text-blue-600 dark:text-blue-400">...</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1 mb-4">Jumlah Pendaftaran</p>
                    <div class="mt-auto pt-4 border-t border-gray-200 dark:border-gray-700 w-full text-sm text-gray-600 dark:text-gray-300">
                        <p class="last-response">Mengutip data...</p>
                    </div>
                </div>
            </a>

            <!-- Card 4: All Events Booking -->
            <a id="form-card-4" href="https://docs.google.com/forms/d/e/1FAIpQLSd_.../viewform" target="_blank" class="form-card block bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden p-6">
                <div class="flex flex-col items-start h-full">
                    <div class="bg-yellow-100 dark:bg-yellow-900 p-4 rounded-lg mb-4">
                        <svg class="w-10 h-10 text-yellow-500 dark:text-yellow-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-5.25h5.25M7.5 15h3M3.375 5.25c-.621 0-1.125.504-1.125 1.125v3.026a2.999 2.999 0 0 1 0 5.198v3.026c0 .621.504 1.125 1.125 1.125h17.25c.621 0 1.125-.504 1.125-1.125v-3.026a2.999 2.999 0 0 1 0-5.198V6.375c0-.621-.504-1.125-1.125-1.125H3.375Z" />
                        </svg>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">Tempahan Package</h2>
                    <p class="response-count text-3xl font-bold text-yellow-600 dark:text-yellow-400">...</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1 mb-4">Jumlah Pendaftaran</p>
                    <div class="mt-auto pt-4 border-t border-gray-200 dark:border-gray-700 w-full text-sm text-gray-600 dark:text-gray-300">
                        <p class="last-response">Mengutip data...</p>
                    </div>
                </div>
            </a>

        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CONFIGURATION ---
            const API_KEY = 'AIzaSyBr10obbPmWZKu8y_tvp-xqhfH9r64NaW8';

            const FORM_CONFIG = [
                {
                    cardId: 'form-card-1',
                    sheetId: '1DcIQUvCUOLNxy4EhrBt64gNe0YLGAGc5JL53w7idmqY'
                },
                {
                    cardId: 'form-card-2',
                    sheetId: '1o48r8mDGTAh8uJZqqv4OAWdGDWJAD4qUCt3UfSkyI7E'
                },
                {
                    cardId: 'form-card-3',
                    sheetId: '1mnLBSDFO8LUtXtMnjOHO-lf6KyVWz76flqortwXyoRw'
                },
                {
                    cardId: 'form-card-4',
                    sheetId: '1FLt9XD8p2rBaNHcp8bjph_f1GwJYHh8LOTCMiu5ec5Y'
                }
            ];

            // --- SCRIPT LOGIC ---

            /**
             * Fetches data from a specific Google Sheet.
             * @param {string} sheetId - The ID of the Google Sheet.
             * @returns {Promise<object>} - A promise that resolves with the sheet data.
             */
            async function fetchSheetData(sheetId) {
                // We only need the first column to get the count and last timestamp
                const range = 'A:A'; 
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${API_KEY}`;
                
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.error('Error fetching sheet data for sheet:', sheetId, error);
                    return null; // Return null on error
                }
            }

            /**
             * Updates a card with the fetched data.
             * @param {HTMLElement} cardElement - The card element to update.
             * @param {object} data - The data from the Google Sheet API.
             */
            function updateCard(cardElement, data) {
                const responseCountEl = cardElement.querySelector('.response-count');
                const lastResponseEl = cardElement.querySelector('.last-response');

                if (!data || !data.values) {
                    responseCountEl.textContent = 'Error';
                    lastResponseEl.textContent = 'Could not fetch data.';
                    return;
                }
                
                // The first row is the header, so we subtract it from the count.
                const responseCount = data.values.length > 1 ? data.values.length - 1 : 0;
                
                // Get the last timestamp from the first column of the last row.
                const lastTimestamp = responseCount > 0 ? data.values[data.values.length - 1][0] : 'No responses yet.';

                // Format the timestamp for better readability
                let formattedDate = 'N/A';
                if (responseCount > 0) {
                   try {
                     const date = new Date(lastTimestamp);
                     formattedDate = date.toLocaleString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: 'numeric',
                        minute: '2-digit',
                        hour12: true
                     });
                   } catch(e) {
                        formattedDate = lastTimestamp; // Fallback to raw timestamp if parsing fails
                   }
                }

                responseCountEl.textContent = responseCount.toLocaleString();
                lastResponseEl.textContent = `Last response: ${formattedDate}`;
            }

            /**
             * Initializes the dashboard by fetching data for all configured forms.
             */
            function initializeDashboard() {
                FORM_CONFIG.forEach(config => {
                    const cardElement = document.getElementById(config.cardId);
                    if (cardElement) {
                        fetchSheetData(config.sheetId).then(data => {
                            updateCard(cardElement, data);
                        });
                    }
                });
            }

            // Start the process
            initializeDashboard();

            // Optional: Refresh data every 5 minutes (300000 milliseconds)
            setInterval(initializeDashboard, 300000);
        });
    </script>
</body>
</html>



